# 日志模型
**该日志系统采用前后端分离的设计方式，即用户在前端（通常为IO线程）使用所提供的写日志接口添加日志消息，而日志消息会缓存在后端的缓冲区（实现了双缓冲设计）中，在后端线程（专用于写日志到文件的线程）集中将日志消息写入日志文件中。这样一来前端只需要调用接口添加日志消息即可，写文件的操作被隐藏在后端线程中，而且锁的争用仅仅发生在前端把消息添加到后端缓冲区和后端的缓冲区交换，前后端分离，后端只负责写文件，效率高。**
![日志模型](./datum/%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9E%8B.png)
## 前端设计
>前端主要由两个类实现，Logger和LogStream，其中Logger实现了内部类Impl。①Logger是前端供IO线程使用的接口，提供宏定义构造Logger来记录日志代码的位置行号等，提供了不同等级的日志消息对象，一条日志消息就是一个Logger对象。②LogStream主要提供了operator<<()来将用户提供的浮点数、整数、地址、二进制内存和字符串等格式化为字符串并加入到本身的缓冲区中，LogStream本身也提供一个缓冲区（默认大小4KB）来存放一条日志消息。
![前端](./datum/%E5%89%8D%E7%AB%AF%E7%B1%BB%E5%9B%BE%E5%85%B3%E7%B3%BB.png)
## 后端设计
>后端主要有三个类，①AsyncLogging提供后端线程以及双缓冲区（实际可能多于两个）、定时将缓冲区的日志消息写到磁盘、维护缓冲区和缓冲区队列。②LogFile提供了日志滚动功能、写文件功能。③AppendFile封装了操作系统提供的基础写文件功能。
![后端](./datum/%E5%90%8E%E7%AB%AF%E7%B1%BB%E5%9B%BE%E5%85%B3%E7%B3%BB.png)